<!DOCTYPE html>
<html>
<head>
    <title>Todo App</title>
</head>
<body>
    <h1>Todo App</h1>

    <!-- Signup -->
    <h2>Signup</h2>
    <input id="signup-username" placeholder="Username">
    <input id="signup-password" type="password" placeholder="Password">
    <button onclick="signup()">Signup</button>

    <!-- Login -->
    <h2>Login</h2>
    <input id="login-username" placeholder="Username">
    <input id="login-password" type="password" placeholder="Password">
    <button onclick="login()">Login</button>

    <!-- Show tasks -->
    <h2>Your Tasks</h2>
    <ul id="task-list"></ul>

    <!-- Add task -->
    <input id="task-input" placeholder="Enter task">
    <button onclick="addTask()">Add Task</button>

<script>
    let token = ""; // store JWT

    async function signup() {
        const username = document.getElementById("signup-username").value;
        const password = document.getElementById("signup-password").value;

        const res = await fetch("http://127.0.0.1:5000/api/signup", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({ username, password })
        });

        alert((await res.json()).message);
    }

    async function login() {
        const username = document.getElementById("login-username").value;
        const password = document.getElementById("login-password").value;

        const res = await fetch("http://127.0.0.1:5000/api/login", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({ username, password })
        });

        const data = await res.json();
        token = data.token;
        alert("Logged in successfully!");

        loadTasks();
    }

    async function loadTasks() {
        const res = await fetch("http://127.0.0.1:5000/api/tasks", {
            headers: {
                "Authorization": "Bearer " + token
            }
        });

        const tasks = await res.json();
        const list = document.getElementById("task-list");
        list.innerHTML = "";

        tasks.forEach(t => {
            const li = document.createElement("li");
            li.innerHTML = `
                ${t.task} - ${t.done ? "✔ Done" : "❌"} 
                <button onclick="completeTask(${t.id})">Complete</button>
                <button onclick="deleteTask(${t.id})">Delete</button>
            `;
            list.appendChild(li);
        });
    }

    async function addTask() {
        const task = document.getElementById("task-input").value;

        await fetch("http://127.0.0.1:5000/api/tasks", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": "Bearer " + token
            },
            body: JSON.stringify({ task })
        });

        loadTasks();
    }

    async function completeTask(id) {
        await fetch(`http://127.0.0.1:5000/api/tasks/${id}`, {
            method: "PUT",
            headers: { "Authorization": "Bearer " + token }
        });

        loadTasks();
    }

    async function deleteTask(id) {
        await fetch(`http://127.0.0.1:5000/api/tasks/${id}`, {
            method: "DELETE",
            headers: { "Authorization": "Bearer " + token }
        });

        loadTasks();
    }
</script>
</body>
</html>
